<!DOCTYPE html>
<html lang="fr" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planificateur 3D - Objectif: 45 000 000 Ar</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Three.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <!-- Custom Styles -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        :root {
            --primary-color: #6a40e6;
            --primary-dark: #5533b3;
            --accent-color: #ff9d00;
            --success-color: #00c853;
            --warning-color: #ffab00;
            --danger-color: #ff1744;
            --dark-bg: #1a1a1a;
            --card-bg: #2a2a2a;
            --text-light: #e0e0e0;
        }

        body {
            background-color: var(--dark-bg);
            color: var(--text-light);
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
        }

        #three-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .container {
            max-width: 960px;
            position: relative;
            z-index: 1;
            background: rgba(26, 26, 26, 0.85);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-top: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
        }

        .card {
            background-color: var(--card-bg);
            border: 1px solid #3d3d3d;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(106, 64, 230, 0.2);
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            border-color: var(--primary-dark);
            transform: translateY(-2px);
        }

        .progress-bar-red { background-color: var(--danger-color); }
        .progress-bar-yellow { background-color: var(--warning-color); }
        .progress-bar-green { background-color: var(--success-color); }

        .task-card {
            background-color: #333;
            border-left: 5px solid;
            transition: all 0.3s ease-in-out;
        }

        .task-card.completed {
            background-color: rgba(0, 200, 83, 0.15);
            border-left-color: var(--success-color);
        }

        .task-card.pending {
            border-left-color: var(--warning-color);
        }

        .task-card.unmet {
            border-left-color: var(--danger-color);
        }

        .form-control, .form-select {
            background-color: #1f1f1f;
            border: 1px solid #4a4a4a;
            color: var(--text-light);
        }

        .form-control:focus, .form-select:focus {
            background-color: #1f1f1f;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(106, 64, 230, 0.25);
            color: var(--text-light);
        }

        .day-heading {
            cursor: pointer;
        }

        .tasks-container {
            display: none;
        }

        .financial-section {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        .financial-section.show {
            display: block;
            opacity: 1;
        }

        .pack-details summary {
            cursor: pointer;
            padding: 0.5rem 0;
            font-weight: 500;
        }

        .pack-details ul {
            padding-left: 1.5rem;
            margin-top: 0.5rem;
            border-left: 2px solid #555;
        }

        .month-section {
            background-color: #1f1f1f;
            border: 2px solid #555;
            transition: transform 0.5s ease;
        }

        .month-section:hover {
            transform: perspective(1000px) translateY(-5px);
        }

        .week-section {
            background-color: #2a2a2a;
            border-left: 5px solid var(--primary-color);
            transition: all 0.3s ease;
        }

        .week-section.open {
            border-color: var(--success-color);
        }

        .month-header, .week-header {
            cursor: pointer;
            padding: 1rem;
            border-radius: 0.75rem;
            transition: background-color 0.2s ease;
        }

        .month-header:hover, .week-header:hover {
            background-color: #333;
        }

        /* Game elements */
        .xp-bar {
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            transition: width 0.5s ease;
        }

        .achievement-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.8rem;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .floating-coin {
            position: absolute;
            width: 20px;
            height: 20px;
            background: gold;
            border-radius: 50%;
            animation: float 3s ease-in-out infinite;
            z-index: 10;
        }

        @keyframes float {
            0% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(180deg); }
            100% { transform: translateY(0) rotate(360deg); }
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: var(--accent-color);
            opacity: 0;
            z-index: 100;
        }

        .level-up {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 2rem;
            border-radius: 1rem;
            text-align: center;
            z-index: 1000;
            display: none;
        }

        .task-completion-effect {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(0, 200, 83, 0.3) 0%, transparent 70%);
            border-radius: inherit;
            opacity: 0;
            pointer-events: none;
        }

        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid var(--primary-color);
            overflow: hidden;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            background: linear-gradient(135deg, #6a40e6, #5533b3);
        }

        .user-avatar.active {
            border-color: var(--accent-color);
            box-shadow: 0 0 15px var(--accent-color);
            transform: scale(1.1);
        }

        .leaderboard {
            background: linear-gradient(135deg, var(--card-bg), #333);
            border-radius: 1rem;
            padding: 1rem;
            margin-top: 1rem;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 0.5rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
        }

        .leaderboard-rank {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            font-weight: bold;
        }

        .leaderboard-item.first .leaderboard-rank {
            background: gold;
            color: #000;
        }

        .leaderboard-item.second .leaderboard-rank {
            background: silver;
            color: #000;
        }

        .leaderboard-item.third .leaderboard-rank {
            background: #cd7f32; /* Bronze */
            color: #000;
        }

        .objective-card {
            background: linear-gradient(135deg, #2a2a2a, #333);
            border-radius: 1rem;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--primary-color);
        }

        .objective-card.completed {
            border-left-color: var(--success-color);
        }

        .objective-card.failed {
            border-left-color: var(--danger-color);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.75rem;
            padding: 1rem;
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #aaa;
        }
    </style>
</head>
<body>
    <div id="three-container"></div>

    <main class="container py-5">
        <!-- Header et s√©lection de l'utilisateur -->
        <header class="text-center mb-5">
            <div class="d-flex justify-content-center align-items-center mb-3">
                <div class="user-avatar active me-4" id="wells-avatar">
                    üë®‚Äçüíº
                </div>
                <div>
                    <h1 class="display-5 fw-bold text-light mb-0">Planificateur 3D</h1>
                    <h2 class="h5 text-secondary">Objectif : 45 000 000 Ar</h2>
                </div>
                <div class="user-avatar ms-4" id="anna-avatar">
                    üë©‚Äçüíº
                </div>
            </div>
            
            <div class="d-flex justify-content-center gap-3 mt-3">
                <button id="wells-btn" class="btn btn-outline-light active">
                    <i class="fas fa-user me-2"></i>Wells
                </button>
                <button id="anna-btn" class="btn btn-outline-light">
                    <i class="fas fa-user me-2"></i>Anna
                </button>
            </div>

            <!-- XP and Level System -->
            <div class="mt-4">
                <div class="d-flex justify-content-between align-items-center mb-1">
                    <span class="small text-muted">Niveau <span id="user-level">1</span></span>
                    <span class="small text-muted"><span id="user-xp">0</span>/<span id="next-level-xp">100</span> XP</span>
                </div>
                <div class="progress" style="height: 10px; border-radius: 5px;">
                    <div class="xp-bar" id="xp-bar" style="width: 0%"></div>
                </div>
            </div>
        </header>

        <!-- Stats Section -->
        <section class="mb-4">
            <h2 class="h4 fw-bold mb-3 text-light text-center">Statistiques</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="completed-tasks">0</div>
                    <div class="stat-label">T√¢ches Compl√©t√©es</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="sales-count">0</div>
                    <div class="stat-label">Ventes R√©alis√©es</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="meetings-count">0</div>
                    <div class="stat-label">RDV Planifi√©s</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="success-rate">0%</div>
                    <div class="stat-label">Taux de R√©ussite</div>
                </div>
            </div>
        </section>

        <!-- Objectives Section -->
        <section class="mb-4">
            <h2 class="h4 fw-bold mb-3 text-light">Objectifs</h2>
            <div class="row" id="objectives-container">
                <!-- Objectifs seront charg√©s dynamiquement -->
            </div>
        </section>

        <!-- Section Suivi d'Objectifs -->
        <section class="mb-5">
            <h2 class="h4 fw-bold mb-3 text-light">Suivi d'Objectifs</h2>
            <div class="card p-4">
                <div id="progress-bars-container">
                    <!-- Les barres de progression seront ins√©r√©es ici par JS -->
                </div>
            </div>
        </section>

        <!-- Bouton pour afficher la section financi√®re -->
        <div class="text-center mb-4">
            <button id="toggle-financial-btn" class="btn btn-outline-success">
                <i class="fas fa-coins me-2"></i>Afficher le suivi financier
            </button>
        </div>

        <!-- Section Plan Tarifaire & Suivi Financier (Initialement masqu√©e) -->
        <section class="mb-5 financial-section" id="financial-section">
            <h2 class="h4 fw-bold mb-3 text-light">Plan Tarifaire & Suivi Financier</h2>
            <div class="row g-3">
                <!-- Plan tarifaire -->
                <div class="col-md-6">
                    <div class="card p-4 h-100">
                        <h3 class="h5 fw-bold mb-3 text-light">Plan Tarifaire</h3>
                        <div id="pricing-plan">
                            <p class="mb-1"><strong>1. Base obligatoire</strong></p>
                            <p class="text-muted small ms-3">Site vitrine : <span class="text-muted">600 000 Ar</span></p>
                            <p class="mb-1"><strong>2. Options compl√©mentaires</strong></p>
                            <ul class="list-unstyled ms-3">
                                <li>H√©bergement + Nom de domaine + Mail Pro : <span class="text-muted">250 000 Ar</span></li>
                                <li>SEO : <span class="text-muted">250 000 Ar</span></li>
                                <li>R√©servation en ligne (Table / Chambre) : <span class="text-muted">300 000 Ar</span></li>
                                <li>Commande en ligne : <span class="text-muted">300 000 Ar</span></li>
                                <li>Maintenance : <span class="text-muted">100 000 Ar / mois</span></li>
                            </ul>
                            <p class="mb-1"><strong>3. Formules strat√©giques (packs cl√©s en main)</strong></p>
                            <details class="pack-details">
                                <summary>Pack Essentiel : 1 100 000 Ar</summary>
                                <ul>
                                    <li>Site vitrine</li>
                                    <li>H√©bergement + Mail Pro</li>
                                    <li>SEO</li>
                                </ul>
                            </details>
                            <details class="pack-details">
                                <summary>Pack Business : 1 400 000 Ar</summary>
                                <ul>
                                    <li>Site vitrine</li>
                                    <li>H√©bergement + Mail Pro</li>
                                    <li>SEO</li>
                                    <li>R√©servation en ligne (Table OU Chambre)</li>
                                </ul>
                            </details>
                            <details class="pack-details">
                                <summary>Pack Premium : 1 700 000 Ar</summary>
                                <ul>
                                    <li>Site vitrine</li>
                                    <li>H√©bergement + Mail Pro</li>
                                    <li>SEO</li>
                                    <li>R√©servation en ligne (Table OU Chambre)</li>
                                    <li>Commande en ligne</li>
                                    <li>Maintenance : 100 000 Ar / mois</li>
                                </ul>
                            </details>
                        </div>
                    </div>
                </div>
                <!-- Suivi financier -->
                <div class="col-md-6">
                    <div class="card p-4 h-100">
                        <h3 class="h5 fw-bold mb-3 text-light">Suivi Financier</h3>
                        <div id="financial-tracker">
                            <div class="mb-3">
                                <label for="ca-input" class="form-label">Chiffre d'affaires total</label>
                                <div class="input-group">
                                    <input type="text" id="ca-input" class="form-control" value="0" readonly>
                                    <span class="input-group-text">Ar</span>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="ca-remaining" class="form-label">Reste √† atteindre</label>
                                <div class="input-group">
                                    <input type="text" id="ca-remaining" class="form-control" value="45 000 000" readonly>
                                    <span class="input-group-text">Ar</span>
                                </div>
                            </div>
                            <div class="text-center mt-4">
                                <h4 class="h6 fw-bold text-light">Ajouter une vente</h4>
                                <div class="d-flex flex-wrap justify-content-center gap-2">
                                    <button class="btn btn-outline-success" onclick="addSale(1100000)">
                                        <i class="fas fa-tag me-1"></i>Pack Essentiel
                                    </button>
                                    <button class="btn btn-outline-warning" onclick="addSale(1400000)">
                                        <i class="fas fa-tag me-1"></i>Pack Business
                                    </button>
                                    <button class="btn btn-outline-info" onclick="addSale(1700000)">
                                        <i class="fas fa-tag me-1"></i>Pack Premium
                                    </button>
                                </div>
                                <div class="mt-3">
                                    <button class="btn btn-link text-danger" onclick="resetSales()">
                                        <i class="fas fa-sync-alt me-1"></i>R√©initialiser les ventes
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Achievements Section -->
        <section class="mb-5">
            <h2 class="h4 fw-bold mb-3 text-light">R√©compenses</h2>
            <div class="card p-4">
                <div class="row">
                    <div class="col-md-6">
                        <h3 class="h5 fw-bold mb-3 text-light">Badges</h3>
                        <div>
                            <span class="achievement-badge"><i class="fas fa-trophy me-1"></i>Premier pas</span>
                            <span class="achievement-badge"><i class="fas fa-bolt me-1"></i>Productivit√©</span>
                            <span class="achievement-badge"><i class="fas fa-check-circle me-1"></i>Consistance</span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h3 class="h5 fw-bold mb-3 text-light">Prochaines r√©compenses</h3>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item bg-transparent text-light border-secondary">
                                <i class="fas fa-lock me-2 text-muted"></i>Ma√Ætre vendeur (√† 10 ventes)
                            </li>
                            <li class="list-group-item bg-transparent text-light border-secondary">
                                <i class="fas fa-lock me-2 text-muted"></i>Expert CRM (√† 50 t√¢ches compl√©t√©es)
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section T√¢ches par jour -->
        <section>
            <h2 class="h4 fw-bold mb-3 text-light">T√¢ches par Jour</h2>
            <div id="daily-tasks-container">
                <!-- Les t√¢ches quotidiennes seront ins√©r√©es ici -->
            </div>
        </section>
    </main>

    <!-- Level Up Notification -->
    <div class="level-up" id="level-up">
        <div class="display-1 text-warning mb-3">
            <i class="fas fa-trophy"></i>
        </div>
        <h3 class="text-light">Niveau Atteint!</h3>
        <p class="text-muted">F√©licitations! Vous avez atteint le niveau <span id="level-number">2</span></p>
    </div>

    <!-- Modal pour ajouter/modifier une t√¢che -->
    <div class="modal fade" id="taskModal" tabindex="-1" aria-labelledby="taskModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="taskModalLabel">Ajouter une t√¢che</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="taskForm">
                        <div class="mb-3">
                            <label for="task-text" class="form-label">T√¢che</label>
                            <input type="text" class="form-control" id="task-text" required>
                        </div>
                        <div class="mb-3">
                            <label for="task-day" class="form-label">Jour</label>
                            <input type="number" class="form-control" id="task-day" min="1" max="90" required>
                        </div>
                        <input type="hidden" id="task-id">
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="submit" form="taskForm" class="btn btn-primary">Sauvegarder</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Three.js Scene Setup
            let scene, camera, renderer, controls;
            let floatingObjects = [];
            
            function initThreeJS() {
                // Create scene
                scene = new THREE.Scene();
                
                // Create camera
                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                camera.position.z = 5;
                
                // Create renderer
                renderer = new THREE.WebGLRenderer({ alpha: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setClearColor(0x000000, 0);
                document.getElementById('three-container').appendChild(renderer.domElement);
                
                // Add controls
                controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.dampingFactor = 0.05;
                controls.rotateSpeed = 0.5;
                
                // Add ambient light
                const ambientLight = new THREE.AmbientLight(0x404040);
                scene.add(ambientLight);
                
                // Add directional light
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
                directionalLight.position.set(1, 1, 1);
                scene.add(directionalLight);
                
                // Create floating geometric objects
                const geometry = new THREE.IcosahedronGeometry(0.2, 0);
                const material = new THREE.MeshPhongMaterial({ 
                    color: 0x6a40e6,
                    shininess: 100,
                    emissive: 0x332266
                });
                
                for (let i = 0; i < 20; i++) {
                    const object = new THREE.Mesh(geometry, material.clone());
                    object.position.x = Math.random() * 10 - 5;
                    object.position.y = Math.random() * 10 - 5;
                    object.position.z = Math.random() * 10 - 5;
                    object.rotation.x = Math.random() * Math.PI;
                    object.rotation.y = Math.random() * Math.PI;
                    object.velocity = {
                        x: (Math.random() - 0.5) * 0.01,
                        y: (Math.random() - 0.5) * 0.01,
                        z: (Math.random() - 0.5) * 0.01
                    };
                    object.material.color.setHex(Math.random() * 0xffffff);
                    scene.add(object);
                    floatingObjects.push(object);
                }
                
                // Handle window resize
                window.addEventListener('resize', onWindowResize, false);
                
                // Start animation
                animate();
            }
            
            function onWindowResize() {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }
            
            function animate() {
                requestAnimationFrame(animate);
                
                // Animate floating objects
                floatingObjects.forEach(obj => {
                    obj.rotation.x += obj.velocity.x;
                    obj.rotation.y += obj.velocity.y;
                    obj.rotation.z += obj.velocity.z;
                    
                    // Bounce within boundaries
                    if (Math.abs(obj.position.x) > 5) obj.velocity.x *= -1;
                    if (Math.abs(obj.position.y) > 5) obj.velocity.y *= -1;
                    if (Math.abs(obj.position.z) > 5) obj.velocity.z *= -1;
                });
                
                controls.update();
                renderer.render(scene, camera);
            }
            
            // Initialize Three.js
            initThreeJS();

            // Game state
            let activeUser = 'Wells';
            let data = {};
            const caGoal = 45000000;
            let userStats = {
                'Wells': { xp: 0, level: 1, completedTasks: 0, sales: 0, meetings: 0 },
                'Anna': { xp: 0, level: 1, completedTasks: 0, sales: 0, meetings: 0 }
            };
            
            // Objectifs par utilisateur
            const userObjectives = {
                'Wells': {
                    weekly: { sales: 2, revenue: 2500000 },
                    monthly: { sales: 8, revenue: 10000000 }
                },
                'Anna': {
                    weekly: { meetings: 5, qualifiedLeads: 10 },
                    monthly: { meetings: 20, qualifiedLeads: 40 }
                }
            };
            
            // Objectifs actuels
            let currentObjectives = {
                'Wells': { sales: 0, revenue: 0 },
                'Anna': { meetings: 0, qualifiedLeads: 0 }
            };
            
            const initialTasks = {
                'Wells': [],
                'Anna': []
            };

            const addTaskToInitial = (user, day, text) => {
                const dayIndex = day - 1;
                if (!initialTasks[user][dayIndex]) {
                    initialTasks[user][dayIndex] = {
                        day: day,
                        tasks: []
                    };
                }
                initialTasks[user][dayIndex].tasks.push({
                    id: crypto.randomUUID(),
                    text: text,
                    completed: false
                });
            };

            // T√¢ches de Wells - Mois 1
            addTaskToInitial('Wells', 1, 'Mettre √† jour les mod√®les du CRM avec les nouvelles cat√©gories de leads (Restaurant, H√¥tel, etc).');
            addTaskToInitial('Wells', 2, 'Cr√©er des templates de site vitrine et de page de commande/r√©servation.');
            addTaskToInitial('Wells', 3, 'Pr√©parer 2 versions de d√©mo du site de r√©servation (une pour restaurant, une pour h√¥tel).');
            addTaskToInitial('Wells', 4, 'Int√©grer le site de d√©mo dans le portfolio de vente du CRM.');
            addTaskToInitial('Wells', 5, 'R√©p√©ter les d√©monstrations pour √™tre fluide.');
            addTaskToInitial('Wells', 6, 'Effectuer des ajustements finaux sur le site de d√©mo et le CRM si n√©cessaire.');
            for (let i = 7; i <= 30; i++) {
                addTaskToInitial('Wells', i, 'Utiliser le CRM pour g√©rer les projets clients, de la signature au lancement.');
                addTaskToInitial('Wells', i, 'Effectuer des d√©mos clients du site de r√©servation et des options de personnalisation.');
                addTaskToInitial('Wells', i, 'D√©velopper les sites vendus en utilisant la base de code existante.');
                addTaskToInitial('Wells', i, 'Suivre les clients existants pour proposer des upsells (maintenance, SEO).');
            }

            // T√¢ches de Wells - Mois 2
            for (let i = 31; i <= 60; i++) {
                addTaskToInitial('Wells', i, 'Cr√©er un nouveau template de site de commande en ligne pour une d√©mo.');
                addTaskToInitial('Wells', i, 'D√©velopper et livrer 2 √† 3 projets clients en simultan√©.');
                addTaskToInitial('Wells', i, 'D√©velopper une base de code r√©utilisable pour les fonctionnalit√©s avanc√©es.');
                addTaskToInitial('Wells', i, 'Lancer une campagne publicitaire cibl√©e (Google Ads) pour les forfaits sup√©rieurs.');
            }

            // T√¢ches de Wells - Mois 3
            for (let i = 61; i <= 90; i++) {
                addTaskToInitial('Wells', i, 'Prospection de grands comptes (h√¥tels de luxe, cha√Ænes de restaurants) dans le CRM.');
                addTaskToInitial('Wells', i, 'D√©velopper de nouvelles solutions sur-mesure (applications mobiles).');
                addTaskToInitial('Wells', i, 'Pr√©parer le rapport final du trimestre et analyser les donn√©es du CRM.');
            }

            // T√¢ches d'Anna - Mois 1
            addTaskToInitial('Anna', 1, 'Importer 500 prospects √† partir du fichier Excel dans le CRM et qualifier les 50 premiers.');
            addTaskToInitial('Anna', 2, 'Personnaliser les messages de prospection dans le CRM pour chaque segment de leads.');
            addTaskToInitial('Anna', 3, 'Envoyer les premi√®res vagues d\'emails et de messages via le CRM.');
            addTaskToInitial('Anna', 4, 'Suivre les r√©ponses dans le CRM et planifier les appels de qualification.');
            addTaskToInitial('Anna', 5, 'Organiser le calendrier de Wells pour les d√©monstrations dans le CRM.');
            addTaskToInitial('Anna', 6, 'Mettre √† jour le statut des prospects dans le pipeline de vente du CRM (Rendez-vous, Devis, etc).');
            for (let i = 7; i <= 30; i++) {
                addTaskToInitial('Anna', i, 'Qualifier 20 nouveaux prospects par jour dans le CRM.');
                addTaskToInitial('Anna', i, 'Suivi et relance des prospects et clients via le CRM (mails, appels).');
                addTaskToInitial('Anna', i, 'Planifier des posts sur les r√©seaux sociaux pour les t√©moignages clients.');
            }

            // T√¢ches d'Anna - Mois 2
            for (let i = 31; i <= 60; i++) {
                addTaskToInitial('Anna', i, 'Identifier les "prospects chauds" dans le CRM et les pousser dans la pipeline de vente.');
                addTaskToInitial('Anna', i, 'G√©n√©rer des rapports d\'activit√© et de performances de vente via le CRM.');
                addTaskToInitial('Anna', i, 'G√©rer les t√¢ches de suivi pour les clients existants (renouvellements de maintenance, satisfaction).');
            }

            // T√¢ches d'Anna - Mois 3
            for (let i = 61; i <= 90; i++) {
                addTaskToInitial('Anna', i, 'Analyser les donn√©es du CRM pour identifier les sources de leads les plus efficaces.');
                addTaskToInitial('Anna', i, 'Cr√©er des tableaux de bord personnalis√©s dans le CRM pour suivre les KPIs.');
                addTaskToInitial('Anna', i, 'Former un nouvel employ√© √† l\'utilisation du CRM.');
            }
            
            let financialState = {
                caTotal: 0
            };

            // R√©cup√©ration des √©l√©ments DOM
            const toggleFinancialBtn = document.getElementById('toggle-financial-btn');
            const financialSection = document.getElementById('financial-section');
            const caInput = document.getElementById('ca-input');
            const caRemaining = document.getElementById('ca-remaining');
            const wellsBtn = document.getElementById('wells-btn');
            const annaBtn = document.getElementById('anna-btn');
            const wellsAvatar = document.getElementById('wells-avatar');
            const annaAvatar = document.getElementById('anna-avatar');
            const progressContainer = document.getElementById('progress-bars-container');
            const dailyTasksContainer = document.getElementById('daily-tasks-container');
            const taskModal = new bootstrap.Modal(document.getElementById('taskModal'));
            const taskForm = document.getElementById('taskForm');
            const taskText = document.getElementById('task-text');
            const taskDay = document.getElementById('task-day');
            const taskId = document.getElementById('task-id');
            const taskModalLabel = document.getElementById('taskModalLabel');
            const xpBar = document.getElementById('xp-bar');
            const userLevel = document.getElementById('user-level');
            const userXp = document.getElementById('user-xp');
            const nextLevelXp = document.getElementById('next-level-xp');
            const levelUpNotification = document.getElementById('level-up');
            const levelNumber = document.getElementById('level-number');
            const completedTasksEl = document.getElementById('completed-tasks');
            const salesCountEl = document.getElementById('sales-count');
            const meetingsCountEl = document.getElementById('meetings-count');
            const successRateEl = document.getElementById('success-rate');
            const objectivesContainer = document.getElementById('objectives-container');

            // Initialisation des donn√©es
            const loadData = () => {
                try {
                    const storedTasks = JSON.parse(localStorage.getItem('plannerData'));
                    if (storedTasks) {
                        data = storedTasks;
                    } else {
                        data = initialTasks;
                        saveData();
                    }
                } catch (e) {
                    console.error("Erreur lors du chargement des t√¢ches depuis localStorage.", e);
                    data = initialTasks;
                    saveData();
                }
                
                try {
                    const storedFinancials = JSON.parse(localStorage.getItem('financialState'));
                    if (storedFinancials) {
                        financialState = storedFinancials;
                        updateFinancialUI();
                    }
                } catch (e) {
                    console.error("Erreur lors du chargement des donn√©es financi√®res depuis localStorage.", e);
                }
                
                try {
                    const storedStats = JSON.parse(localStorage.getItem('userStats'));
                    if (storedStats) {
                        userStats = storedStats;
                        updateUserStatsUI();
                    }
                } catch (e) {
                    console.error("Erreur lors du chargement des stats utilisateur depuis localStorage.", e);
                }
                
                try {
                    const storedObjectives = JSON.parse(localStorage.getItem('currentObjectives'));
                    if (storedObjectives) {
                        currentObjectives = storedObjectives;
                    }
                } catch (e) {
                    console.error("Erreur lors du chargement des objectifs depuis localStorage.", e);
                }
            };

            // Sauvegarde des donn√©es
            const saveData = () => {
                localStorage.setItem('plannerData', JSON.stringify(data));
                localStorage.setItem('financialState', JSON.stringify(financialState));
                localStorage.setItem('userStats', JSON.stringify(userStats));
                localStorage.setItem('currentObjectives', JSON.stringify(currentObjectives));
            };

            // Mise √† jour de l'interface utilisateur
            const updateUI = () => {
                renderProgressBars();
                renderDailyTasks();
                updateUserStatsUI();
                renderObjectives();
            };

            // Mise √† jour des statistiques utilisateur
            const updateUserStatsUI = () => {
                const stats = userStats[activeUser];
                userLevel.textContent = stats.level;
                userXp.textContent = stats.xp;
                nextLevelXp.textContent = stats.level * 100;
                
                const xpPercentage = (stats.xp / (stats.level * 100)) * 100;
                xpBar.style.width = `${Math.min(xpPercentage, 100)}%`;
                
                // Mettre √† jour les statistiques
                completedTasksEl.textContent = stats.completedTasks;
                salesCountEl.textContent = stats.sales;
                meetingsCountEl.textContent = stats.meetings;
                
                // Calculer le taux de r√©ussite
                const totalTasks = data[activeUser].reduce((total, day) => total + (day ? day.tasks.length : 0), 0);
                const successRate = totalTasks > 0 ? Math.round((stats.completedTasks / totalTasks) * 100) : 0;
                successRateEl.textContent = `${successRate}%`;
            };

            // Mise √† jour de l'interface financi√®re
            const updateFinancialUI = () => {
                caInput.value = formatCurrency(financialState.caTotal);
                caRemaining.value = formatCurrency(caGoal - financialState.caTotal);
            };

            // Formatage des montants
            const formatCurrency = (amount) => {
                return new Intl.NumberFormat('fr-FR').format(amount);
            };

            // Ajout d'une vente
            window.addSale = (amount) => {
                financialState.caTotal += amount;
                userStats[activeUser].sales += 1;
                userStats[activeUser].xp += 50;
                currentObjectives[activeUser].sales += 1;
                currentObjectives[activeUser].revenue += amount;
                
                // V√©rifier si un niveau est atteint
                checkLevelUp();
                
                updateFinancialUI();
                updateUserStatsUI();
                renderObjectives();
                saveData();
                
                // Effet visuel
                createFloatingCoin();
                createConfetti();
            };

            // Ajout d'un rendez-vous (pour Anna)
            const addMeeting = () => {
                userStats['Anna'].meetings += 1;
                userStats['Anna'].xp += 30;
                currentObjectives['Anna'].meetings += 1;
                
                // V√©rifier si un niveau est atteint
                checkLevelUp();
                
                updateUserStatsUI();
                renderObjectives();
                saveData();
                
                // Effet visuel
                createConfetti();
            };

            // R√©initialisation des ventes
            window.resetSales = () => {
                if (confirm("√ätes-vous s√ªr de vouloir r√©initialiser toutes les ventes ?")) {
                    financialState.caTotal = 0;
                    updateFinancialUI();
                    saveData();
                }
            };

            // V√©rification du niveau
            const checkLevelUp = () => {
                const stats = userStats[activeUser];
                const xpNeeded = stats.level * 100;
                
                if (stats.xp >= xpNeeded) {
                    stats.level += 1;
                    stats.xp = 0;
                    
                    // Afficher la notification de niveau
                    levelNumber.textContent = stats.level;
                    levelUpNotification.style.display = 'block';
                    
                    setTimeout(() => {
                        levelUpNotification.style.display = 'none';
                    }, 3000);
                    
                    updateUserStatsUI();
                    saveData();
                }
            };

            // Cr√©ation d'une pi√®ce flottante (effet visuel)
            const createFloatingCoin = () => {
                const coin = document.createElement('div');
                coin.className = 'floating-coin';
                coin.style.left = `${Math.random() * 100}%`;
                coin.style.top = `${Math.random() * 100}%`;
                document.body.appendChild(coin);
                
                setTimeout(() => {
                    coin.remove();
                }, 3000);
            };

            // Cr√©ation de confettis (effet visuel)
            const createConfetti = () => {
                for (let i = 0; i < 30; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = `${Math.random() * 100}%`;
                    confetti.style.top = `${Math.random() * 100}%`;
                    confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
                    document.body.appendChild(confetti);
                    
                    // Animation
                    setTimeout(() => {
                        confetti.style.opacity = '1';
                        confetti.style.transform = `translateY(${window.innerHeight}px) rotate(${Math.random() * 360}deg)`;
                        confetti.style.transition = 'all 2s ease-out';
                    }, 10);
                    
                    // Suppression
                    setTimeout(() => {
                        confetti.remove();
                    }, 2000);
                }
            };

            // Rendu des barres de progression
            const renderProgressBars = () => {
                const userTasks = data[activeUser] || [];
                const totalTasks = userTasks.flatMap(day => day ? day.tasks : []).length;
                const completedTasks = userTasks.flatMap(day => day ? day.tasks.filter(task => task.completed) : []).length;
                
                const progressPercentage = totalTasks > 0 ? (completedTasks / totalTasks) * 100 : 0;
                
                let progressColorClass = 'bg-success';
                if (progressPercentage < 33) {
                    progressColorClass = 'progress-bar-red';
                } else if (progressPercentage < 66) {
                    progressColorClass = 'progress-bar-yellow';
                }
                
                progressContainer.innerHTML = `
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <span class="small text-muted">Progression des t√¢ches</span>
                            <span class="small text-muted">${completedTasks}/${totalTasks} (${Math.round(progressPercentage)}%)</span>
                        </div>
                        <div class="progress" style="height: 10px; border-radius: 5px;">
                            <div class="progress-bar ${progressColorClass}" role="progressbar" style="width: ${progressPercentage}%" aria-valuenow="${progressPercentage}" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                    <div>
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <span class="small text-muted">Objectif financier</span>
                            <span class="small text-muted">${formatCurrency(financialState.caTotal)}/${formatCurrency(caGoal)} Ar</span>
                        </div>
                        <div class="progress" style="height: 10px; border-radius: 5px;">
                            <div class="progress-bar bg-info" role="progressbar" style="width: ${(financialState.caTotal / caGoal) * 100}%" aria-valuenow="${(financialState.caTotal / caGoal) * 100}" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                `;
            };

            // Rendu des objectifs
            const renderObjectives = () => {
                const objectives = userObjectives[activeUser];
                const current = currentObjectives[activeUser];
                let html = '';
                
                if (activeUser === 'Wells') {
                    // Objectifs de Wells (ventes)
                    const weeklySalesProgress = Math.min(100, (current.sales / objectives.weekly.sales) * 100);
                    const weeklyRevenueProgress = Math.min(100, (current.revenue / objectives.weekly.revenue) * 100);
                    const monthlySalesProgress = Math.min(100, (current.sales / objectives.monthly.sales) * 100);
                    const monthlyRevenueProgress = Math.min(100, (current.revenue / objectives.monthly.revenue) * 100);
                    
                    html = `
                        <div class="col-md-6">
                            <div class="objective-card ${current.sales >= objectives.weekly.sales ? 'completed' : ''}">
                                <h5 class="fw-bold">Objectif Hebdomadaire - Ventes</h5>
                                <p>${current.sales} / ${objectives.weekly.sales} ventes</p>
                                <div class="progress mb-2">
                                    <div class="progress-bar bg-success" role="progressbar" style="width: ${weeklySalesProgress}%"></div>
                                </div>
                                <p>${formatCurrency(current.revenue)} / ${formatCurrency(objectives.weekly.revenue)} Ar</p>
                                <div class="progress">
                                    <div class="progress-bar bg-info" role="progressbar" style="width: ${weeklyRevenueProgress}%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="objective-card ${current.sales >= objectives.monthly.sales ? 'completed' : ''}">
                                <h5 class="fw-bold">Objectif Mensuel - Ventes</h5>
                                <p>${current.sales} / ${objectives.monthly.sales} ventes</p>
                                <div class="progress mb-2">
                                    <div class="progress-bar bg-success" role="progressbar" style="width: ${monthlySalesProgress}%"></div>
                                </div>
                                <p>${formatCurrency(current.revenue)} / ${formatCurrency(objectives.monthly.revenue)} Ar</p>
                                <div class="progress">
                                    <div class="progress-bar bg-info" role="progressbar" style="width: ${monthlyRevenueProgress}%"></div>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    // Objectifs d'Anna (rendez-vous)
                    const weeklyMeetingsProgress = Math.min(100, (current.meetings / objectives.weekly.meetings) * 100);
                    const monthlyMeetingsProgress = Math.min(100, (current.meetings / objectives.monthly.meetings) * 100);
                    
                    html = `
                        <div class="col-md-6">
                            <div class="objective-card ${current.meetings >= objectives.weekly.meetings ? 'completed' : ''}">
                                <h5 class="fw-bold">Objectif Hebdomadaire - RDV</h5>
                                <p>${current.meetings} / ${objectives.weekly.meetings} rendez-vous</p>
                                <div class="progress">
                                    <div class="progress-bar bg-success" role="progressbar" style="width: ${weeklyMeetingsProgress}%"></div>
                                </div>
                                <div class="text-end mt-2">
                                    <button class="btn btn-sm btn-outline-primary" onclick="addMeeting()">
                                        <i class="fas fa-calendar-plus me-1"></i>Ajouter un RDV
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="objective-card ${current.meetings >= objectives.monthly.meetings ? 'completed' : ''}">
                                <h5 class="fw-bold">Objectif Mensuel - RDV</h5>
                                <p>${current.meetings} / ${objectives.monthly.meetings} rendez-vous</p>
                                <div class="progress">
                                    <div class="progress-bar bg-success" role="progressbar" style="width: ${monthlyMeetingsProgress}%"></div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                objectivesContainer.innerHTML = html;
            };

            // Rendu des t√¢ches quotidiennes
            const renderDailyTasks = () => {
                const userTasks = data[activeUser] || [];
                let html = '';
                
                // Regrouper les t√¢ches par mois
                const months = [
                    { name: "Mois 1", days: userTasks.slice(0, 30) },
                    { name: "Mois 2", days: userTasks.slice(30, 60) },
                    { name: "Mois 3", days: userTasks.slice(60, 90) }
                ];
                
                months.forEach((month, monthIndex) => {
                    const monthNumber = monthIndex + 1;
                    html += `
                        <div class="month-section mb-4">
                            <div class="month-header d-flex justify-content-between align-items-center" data-month="${monthNumber}">
                                <h3 class="h5 mb-0">${month.name}</h3>
                                <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
                            </div>
                            <div class="month-content mt-3" id="month-${monthNumber}" style="display:none;">
                    `;
                    
                    // Regrouper les jours par semaine
                    for (let week = 0; week < 5; week++) {
                        const weekStart = week * 7;
                        const weekDays = month.days.slice(weekStart, weekStart + 7);
                        
                        html += `
                            <div class="week-section mb-3">
                                <div class="week-header d-flex justify-content-between align-items-center" data-week="${monthNumber}-${week+1}">
                                    <h4 class="h6 mb-0">Semaine ${week+1}</h4>
                                    <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
                                </div>
                                <div class="week-content mt-2" id="week-${monthNumber}-${week+1}" style="display:none;">
                        `;
                        
                        weekDays.forEach((dayData, dayIndex) => {
                            const dayNumber = monthIndex * 30 + week * 7 + dayIndex + 1;
                            if (dayData && dayData.tasks && dayData.tasks.length > 0) {
                                html += `
                                    <div class="card mb-2">
                                        <div class="card-header day-heading" data-day="${dayNumber}">
                                            <h5 class="h6 mb-0 d-flex justify-content-between align-items-center">
                                                <span>Jour ${dayNumber}</span>
                                                <span class="badge bg-primary rounded-pill">${dayData.tasks.length}</span>
                                            </h5>
                                        </div>
                                        <div class="tasks-container" id="day-${dayNumber}" style="display:none;">
                                            <div class="card-body p-3">
                                `;
                                
                                dayData.tasks.forEach(task => {
                                    html += `
                                        <div class="task-card card mb-2 ${task.completed ? 'completed' : 'pending'}" data-task-id="${task.id}">
                                            <div class="card-body d-flex justify-content-between align-items-center">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" ${task.completed ? 'checked' : ''} id="task-${task.id}">
                                                    <label class="form-check-label ${task.completed ? 'text-decoration-line-through text-muted' : ''}" for="task-${task.id}">
                                                        ${task.text}
                                                    </label>
                                                </div>
                                                <button class="btn btn-sm btn-outline-secondary edit-task" data-task-id="${task.id}">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                            </div>
                                            <div class="task-completion-effect"></div>
                                        </div>
                                    `;
                                });
                                
                                html += `
                                                <button class="btn btn-sm btn-outline-primary add-task-btn" data-day="${dayNumber}">
                                                    <i class="fas fa-plus me-1"></i>Ajouter une t√¢che
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }
                        });
                        
                        html += `
                                </div>
                            </div>
                        `;
                    }
                    
                    html += `
                            </div>
                        </div>
                    `;
                });
                
                dailyTasksContainer.innerHTML = html;
                
                // Ajouter les √©couteurs d'√©v√©nements
                document.querySelectorAll('.month-header').forEach(header => {
                    header.addEventListener('click', () => {
                        const monthNumber = header.getAttribute('data-month');
                        const content = document.getElementById(`month-${monthNumber}`);
                        const icon = header.querySelector('.toggle-icon i');
                        
                        if (content.style.display === 'none') {
                            content.style.display = 'block';
                            icon.className = 'fas fa-chevron-up';
                        } else {
                            content.style.display = 'none';
                            icon.className = 'fas fa-chevron-down';
                        }
                    });
                });
                
                document.querySelectorAll('.week-header').forEach(header => {
                    header.addEventListener('click', () => {
                        const weekId = header.getAttribute('data-week');
                        const content = document.getElementById(`week-${weekId}`);
                        const icon = header.querySelector('.toggle-icon i');
                        
                        if (content.style.display === 'none') {
                            content.style.display = 'block';
                            icon.className = 'fas fa-chevron-up';
                            header.parentElement.classList.add('open');
                        } else {
                            content.style.display = 'none';
                            icon.className = 'fas fa-chevron-down';
                            header.parentElement.classList.remove('open');
                        }
                    });
                });
                
                document.querySelectorAll('.day-heading').forEach(header => {
                    header.addEventListener('click', () => {
                        const dayNumber = header.getAttribute('data-day');
                        const content = document.getElementById(`day-${dayNumber}`);
                        
                        if (content.style.display === 'none') {
                            content.style.display = 'block';
                        } else {
                            content.style.display = 'none';
                        }
                    });
                });
                
                document.querySelectorAll('.form-check-input').forEach(checkbox => {
                    checkbox.addEventListener('change', (e) => {
                        const taskId = e.target.closest('.task-card').getAttribute('data-task-id');
                        const isChecked = e.target.checked;
                        
                        // Trouver la t√¢che dans les donn√©es
                        for (let day of data[activeUser]) {
                            if (day && day.tasks) {
                                const task = day.tasks.find(t => t.id === taskId);
                                if (task) {
                                    task.completed = isChecked;
                                    
                                    // Mettre √† jour l'apparence
                                    const taskCard = e.target.closest('.task-card');
                                    if (isChecked) {
                                        taskCard.classList.add('completed');
                                        taskCard.classList.remove('pending');
                                        
                                        // Ajouter de l'XP
                                        userStats[activeUser].completedTasks += 1;
                                        userStats[activeUser].xp += 10;
                                        
                                        // V√©rifier si un niveau est atteint
                                        checkLevelUp();
                                        
                                        // Effet visuel
                                        const effect = taskCard.querySelector('.task-completion-effect');
                                        effect.style.opacity = '1';
                                        setTimeout(() => {
                                            effect.style.opacity = '0';
                                        }, 1000);
                                    } else {
                                        taskCard.classList.remove('completed');
                                        taskCard.classList.add('pending');
                                        
                                        // Retirer l'XP
                                        userStats[activeUser].completedTasks -= 1;
                                        userStats[activeUser].xp -= 10;
                                    }
                                    
                                    updateUserStatsUI();
                                    saveData();
                                    renderProgressBars();
                                    break;
                                }
                            }
                        }
                    });
                });
                
                document.querySelectorAll('.edit-task').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const taskId = button.getAttribute('data-task-id');
                        
                        // Trouver la t√¢che dans les donn√©es
                        for (let day of data[activeUser]) {
                            if (day && day.tasks) {
                                const task = day.tasks.find(t => t.id === taskId);
                                if (task) {
                                    taskText.value = task.text;
                                    taskDay.value = day.day;
                                    taskId.value = task.id;
                                    
                                    taskModalLabel.textContent = 'Modifier la t√¢che';
                                    taskModal.show();
                                    break;
                                }
                            }
                        }
                    });
                });
                
                document.querySelectorAll('.add-task-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const day = button.getAttribute('data-day');
                        
                        taskText.value = '';
                        taskDay.value = day;
                        taskId.value = '';
                        
                        taskModalLabel.textContent = 'Ajouter une t√¢che';
                        taskModal.show();
                    });
                });
            };

            // Gestion du formulaire de t√¢che
            taskForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const text = taskText.value.trim();
                const day = parseInt(taskDay.value);
                const id = taskId.value;
                
                if (text && day >= 1 && day <= 90) {
                    // Cr√©er ou mettre √† jour la t√¢che
                    if (id) {
                        // Modification d'une t√¢che existante
                        for (let dayData of data[activeUser]) {
                            if (dayData && dayData.tasks) {
                                const taskIndex = dayData.tasks.findIndex(t => t.id === id);
                                if (taskIndex !== -1) {
                                    dayData.tasks[taskIndex].text = text;
                                    break;
                                }
                            }
                        }
                    } else {
                        // Ajout d'une nouvelle t√¢che
                        const dayIndex = day - 1;
                        if (!data[activeUser][dayIndex]) {
                            data[activeUser][dayIndex] = {
                                day: day,
                                tasks: []
                            };
                        }
                        
                        data[activeUser][dayIndex].tasks.push({
                            id: crypto.randomUUID(),
                            text: text,
                            completed: false
                        });
                    }
                    
                    saveData();
                    renderDailyTasks();
                    renderProgressBars();
                    
                    taskModal.hide();
                }
            });

            // Basculer l'affichage de la section financi√®re
            toggleFinancialBtn.addEventListener('click', () => {
                if (financialSection.classList.contains('show')) {
                    financialSection.classList.remove('show');
                    toggleFinancialBtn.innerHTML = '<i class="fas fa-coins me-2"></i>Afficher le suivi financier';
                    toggleFinancialBtn.classList.remove('btn-success');
                    toggleFinancialBtn.classList.add('btn-outline-success');
                } else {
                    financialSection.classList.add('show');
                    toggleFinancialBtn.innerHTML = '<i class="fas fa-times me-2"></i>Masquer le suivi financier';
                    toggleFinancialBtn.classList.remove('btn-outline-success');
                    toggleFinancialBtn.classList.add('btn-success');
                }
            });

            // Changer d'utilisateur
            wellsBtn.addEventListener('click', () => {
                if (activeUser !== 'Wells') {
                    activeUser = 'Wells';
                    wellsBtn.classList.add('active');
                    annaBtn.classList.remove('active');
                    wellsAvatar.classList.add('active');
                    annaAvatar.classList.remove('active');
                    updateUI();
                }
            });

            annaBtn.addEventListener('click', () => {
                if (activeUser !== 'Anna') {
                    activeUser = 'Anna';
                    annaBtn.classList.add('active');
                    wellsBtn.classList.remove('active');
                    annaAvatar.classList.add('active');
                    wellsAvatar.classList.remove('active');
                    updateUI();
                }
            });

            // Exposer addMeeting globalement
            window.addMeeting = addMeeting;

            // Initialiser l'application
            loadData();
            updateUI();
        });
    </script>
</body>
</html>
